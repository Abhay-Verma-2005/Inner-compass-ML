<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCore ML Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .circular-progress {
            background: radial-gradient(closest-side, white 79%, transparent 80% 100%),
            conic-gradient(#4f46e5 calc(var(--pg) * 1%), #f1f5f9 0);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-white shadow-2xl rounded-3xl overflow-hidden flex flex-col h-[750px]">
        <header class="bg-white border-b px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-slate-800">MindCore ML</h1>
            <span class="text-[10px] bg-indigo-100 text-indigo-600 px-2 py-1 rounded font-bold">DTREE-V1</span>
        </header>

        <main id="app-content" class="flex-1 overflow-y-auto p-6">
            <form id="mainForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-1">Gender</label>
                        <select id="gender" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl">
                            <option>Female</option>
                            <option>Male</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-400 mb-1">Occupation</label>
                        <select id="occupation" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl">
                            <option>Corporate</option>
                            <option>Student</option>
                            <option>Business</option>
                            <option>Others</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-1">Days Indoors</label>
                    <select id="daysIndoors" class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl">
                        <option>Go out Every day</option>
                        <option>1-14 days</option>
                        <option>15-30 days</option>
                        <option>More than 1 months</option>
                    </select>
                </div>
                <div class="space-y-3 py-2">
                    <label class="flex items-center space-x-3 text-sm text-slate-600">
                        <input type="checkbox" id="healthHistory" class="w-5 h-5 rounded border-slate-300 text-indigo-600">
                        <span>Mental Health History</span>
                    </label>
                    <label class="flex items-center space-x-3 text-sm text-slate-600">
                        <input type="checkbox" id="moodSwings" class="w-5 h-5 rounded border-slate-300 text-indigo-600">
                        <span>Growing Stress / Mood Swings</span>
                    </label>
                    <label class="flex items-center space-x-3 text-sm text-slate-600">
                        <input type="checkbox" id="changeHabits" class="w-5 h-5 rounded border-slate-300 text-indigo-600">
                        <span>Changes in Habits</span>
                    </label>
                </div>
                <div>
                    <label class="block text-xs font-bold uppercase text-slate-400 mb-1">How do you feel?</label>
                    <textarea id="summary" required class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl h-24" placeholder="Type a few words about your mood..."></textarea>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl hover:bg-indigo-700 transition-all">Run ML Prediction</button>
            </form>
        </main>
    </div>

    <script>
        const GOOD_WORDS = ['happy', 'joyful', 'peaceful', 'energetic', 'relaxed', 'focused', 'calm', 'grateful', 'hopeful', 'positive'];
        const BAD_WORDS = ['sad', 'stressed', 'anxious', 'tired', 'overwhelmed', 'angry', 'hopeless', 'lonely', 'depressed', 'negative'];

        document.getElementById('mainForm').onsubmit = async (e) => {
            e.preventDefault();
            const summary = document.getElementById('summary').value.toLowerCase();
            const words = summary.replace(/[^a-z0-9 ]/g, '').split(/\s+/);
            let gCount = 0, bCount = 0;
            words.forEach(w => {
                if(GOOD_WORDS.includes(w)) gCount++;
                if(BAD_WORDS.includes(w)) bCount++;
            });

            const payload = {
                gender: document.getElementById('gender').value,
                occupation: document.getElementById('occupation').value,
                daysIndoors: document.getElementById('daysIndoors').value,
                healthHistory: document.getElementById('healthHistory').checked,
                moodSwings: document.getElementById('moodSwings').checked,
                changeHabits: document.getElementById('changeHabits').checked,
                sentimentImpact: (gCount * 0.15) - (bCount * 0.15)
            };

            const appContent = document.getElementById('app-content');
            appContent.innerHTML = '<div class="h-full flex flex-col items-center justify-center"><div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div><p class="mt-4 text-slate-500">Processing Decision Tree...</p></div>';

            const res = await fetch('/predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            const result = await res.json();

            appContent.innerHTML = `
                <div class="text-center space-y-6 py-8">
                    <div class="circular-progress mx-auto w-36 h-36 rounded-full flex items-center justify-center" style="--pg: ${result.score * 10}">
                        <span class="text-3xl font-bold text-slate-800">${result.score}</span>
                    </div>
                    <h2 class="text-2xl font-bold ${result.color}">${result.label}</h2>
                    <button onclick="location.reload()" class="w-full border-2 py-3 rounded-xl text-slate-400 font-bold">New Assessment</button>
                </div>
            `;
        };
    </script>
</body>
</html>
